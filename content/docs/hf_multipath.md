---
title: "Exploring the problem of Multipath on HF"
date: 2024-01-03T00:48:54-05:00
draft: true
---
Imagine there were beings who naturally developed the ability to emit and sense radio waves in the HF region, also known as shortwave. What methods would they evolve to communicate with each other? How would such communications sound, when these signals are shifted down to the audio range and turned into pressure waves in the air rather than EM waves? What sorts of clever tricks and optimizations could evolution come up with, which we humans couldn't imagine in a million years? \
I'd guess that the closest equivalent reality would be the songs of humpback whales, which propagate thousands of kilometres through the open ocean (whenever human activities do not harmfully interfere). I have no idea how our hypothetical HF-speaking beings would talk to each other, but in my mind's eye it might be something like the oddly haunting sounds of the humpback whales.

### So, what the heck was that all about?
I'll get to that in a bit. First of all, I have been considering the problem of multipath in HF data modems. An excellent starting point for considering this problem is given by this handy ITU publication, [Rec. ITU-R F.1487][]. \
Briefly: multipath is a phenomenon where a radio signal transmitted at point A arrives at a receiver at point B over multiple paths (very creative name). Each path from A to B has a different length and thus a different amount of time delay as each individual ray travels at the speed of light. So, multiple copies of a transmitted signal arrive at the receiver with different time delays and interfere with themselves. Multipath induced time delays between individual rays are on the order of milliseconds on HF, with realistic values for a 2-ray model given in [Rec. ITU-R F.1487][] as between 0.5ms for a "Quiet Mid-Latitude" channel to up to 7ms for a "Disturbed High-Latitude" channel. \
Turning up the transmitted power doesn't help, because the desired signal is itself the source of this interference; any increase in the power of the desired ray will increase the power of the secondary (interfering) rays in exact proportion to the desired ray. It is thus possible to receive a high amount of power from a transmitter and still be unable to decode their signal, because of self-interference due to multipath. A less extreme version of this would be to initiate a data connection with a station that appears to be very strong, but the effective throughput is much less than one would guess given the apparent strength of the signal. This is somewhat analogous to echoing or reverberation in acoustics, where time-delayed copies of a spoken sentence can add up to make a combined sound that is much less intelligible than a sentence spoken at the same volume in a less echo-prone room. \
There are additional effects at play here: because these multiple paths taken by the signal are refracted by the ionosphere's multiple layers, and these layers can change in height over time. Since now we're scattering waves off of a moving object, a frequency shift is inevitable due to the Dopler effect. Each path taken by the signal is scattered off of different ionosphere layers at different locations with different velocities, so each ray is shifted in frequency by a different amount. This spreading of the signal due to multiple rays with different Doppler shifts is known as Doppler spreading (we're just killing it with the creative names here). Referring again to [Rec. ITU-R F.1487][], Doppler spread values for HF channels are on the order of Hz, with 0.1Hz being representative of a "Quiet Mid-Latitude" channel, while on the opposite extreme we find 30Hz as representative of a "Disturbed High-Latitude". \
In general, it's possible for there to be an arbitrary number of independent rays, each with their own Doppler shift and delay. I will refer to all the different delays and Doppler spreads needed to specify a mutlipath-impaired channel as its *multipath profile*. Unless otherwise specified I will be implicitly evaluating things in terms of a 2-ray model where the multipath profile can be fully specified by just one time delay and one Doppler spread.

### What can we do about multipath? Also, you still haven't gotten to the whalesong thing yet...
Multipath is a fact of life on HF, and any practical data modem used on HF channels must be at least somewhat tolerant of its effects. Delay between one ray and another cause the resulting combined signal at the receiver to have overlapping symbols, smearing together the boundaries between one symbol and the next, which is referred to as inter-symbol interference or ISI. Modems designed for use over telephone lines (where this sort of multipath doesn't occur) can barely tolerate HF multipath conditions at the best of times; for example the classic Bell 103 300bd 2-FSK. 300bd corresponds to a symbol period of about 3.3ms, which is on the same order of magnitude as the multipath delay on a realistic HF channel. In the extreme case of a 7ms delay in a 2-ray model, the time difference between rays corresponds to two whole symbols of offset between one ray and the other. That is; for a given Bell 103 symbol transmitted in this scenario, this symbol will be overlapped by whatever the transmitter was sending two symbol periods ago. Bell 202 with its 1200bd 2-FSK (corresponding to about 0.83ms per symbol) would be utterly hopeless, on all but the mildest 0.5ms delay scenario, and even then, over half of any given symbol's period will be taken up by interference from the other ray in a 2-ray model. \
All of this strongly suggests that multipath interference due to the delay profile can be mitigated by using a lower symbol rate; it stands to reason that sending each symbol for a longer amount of time should reduce the interference caused by the delay. If the delay is much less than the symbol period, then the inter-symbol interference should be confined to a small percentage of the time after the symbol change has taken place, and for the remaining part of the symbol period the transmission only has to contend with interference from the same symbol that is currently being sent, and this interference can sometimes even be constructive if you're lucky.  This heuristic of lowering the symbol rate is the only plausible answer I have seen for addressing the problem of multipath in modulation design, but it's really just a heuristic and not subject to some Information-Theoretic law like the Shannonâ€“Hartley theorem does for AWGN channels. As best as I can tell, **no optimal scheme is currently known for mitigating multipath effects on a RF channel**. 
 

[Rec. ITU-R F.1487]: <https://www.itu.int/dms_pubrec/itu-r/rec/f/R-REC-F.1487-0-200005-I!!PDF-E.pdf> 
[N5TW]: <https://www.winlink.org/sites/default/files/downloads/a_winlink_digital_mode_performance_comparison_based_on_the_ionis_sim_hf_vhf_channel_simulator_-_november_2_2020_0.pdf>
[An Introduction to Deep Learning for the Physical Layer]: <https://arxiv.org/abs/1702.00832>
